<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ChirpStack â€” Open-Source LoRaWAN Network Server</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=DM+Mono:ital,wght@0,300;0,400;0,500;1,400&family=Source+Serif+4:ital,opsz,wght@0,8..60,300;0,8..60,400;0,8..60,600;0,8..60,700;1,8..60,400&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

:root {
  --bg-deep: #060a10;
  --bg-primary: #0a0e14;
  --bg-raised: #0f1520;
  --bg-card: #121a28;
  --bg-card-hover: #162030;
  --teal: #00e5c7;
  --teal-dim: #00c4aa;
  --teal-glow: rgba(0,229,199,0.15);
  --teal-glow-strong: rgba(0,229,199,0.3);
  --amber: #f5a623;
  --amber-dim: #d4901e;
  --amber-glow: rgba(245,166,35,0.12);
  --rust-orange: #e8622c;
  --text-primary: #e2e8f0;
  --text-secondary: #8892a4;
  --text-dim: #4a5568;
  --border: #1a2435;
  --border-light: #243045;
  --mono: 'DM Mono', 'Fira Code', monospace;
  --serif: 'Source Serif 4', Georgia, serif;
}

html { scroll-behavior: smooth; }

body {
  font-family: var(--serif);
  background: var(--bg-deep);
  color: var(--text-primary);
  overflow-x: hidden;
  line-height: 1.7;
  -webkit-font-smoothing: antialiased;
}

/* ========== NOISE TEXTURE OVERLAY ========== */
body::before {
  content: '';
  position: fixed;
  inset: 0;
  z-index: 9999;
  pointer-events: none;
  opacity: 0.025;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
  background-repeat: repeat;
  background-size: 256px 256px;
}

/* ========== GRID BACKGROUND ========== */
.grid-bg {
  position: fixed;
  inset: 0;
  z-index: 0;
  background-image:
    linear-gradient(var(--border) 1px, transparent 1px),
    linear-gradient(90deg, var(--border) 1px, transparent 1px);
  background-size: 60px 60px;
  opacity: 0.15;
  mask-image: radial-gradient(ellipse 70% 60% at 50% 30%, black 20%, transparent 70%);
  -webkit-mask-image: radial-gradient(ellipse 70% 60% at 50% 30%, black 20%, transparent 70%);
}

/* ========== SCROLL REVEAL ========== */
.reveal {
  opacity: 0;
  transform: translateY(40px);
  transition: opacity 0.8s cubic-bezier(0.16, 1, 0.3, 1), transform 0.8s cubic-bezier(0.16, 1, 0.3, 1);
}
.reveal.visible {
  opacity: 1;
  transform: translateY(0);
}
.reveal-delay-1 { transition-delay: 0.1s; }
.reveal-delay-2 { transition-delay: 0.2s; }
.reveal-delay-3 { transition-delay: 0.3s; }
.reveal-delay-4 { transition-delay: 0.4s; }
.reveal-delay-5 { transition-delay: 0.5s; }
.reveal-delay-6 { transition-delay: 0.6s; }

/* ========== NAV ========== */
nav {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  z-index: 1000;
  padding: 0 40px;
  height: 64px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  background: rgba(6,10,16,0.8);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border-bottom: 1px solid var(--border);
  font-family: var(--mono);
}

.nav-logo {
  font-size: 15px;
  font-weight: 500;
  color: var(--teal);
  letter-spacing: 0.5px;
  display: flex;
  align-items: center;
  gap: 10px;
}

.nav-logo .dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: var(--teal);
  box-shadow: 0 0 12px var(--teal-glow-strong);
  animation: pulse-dot 2s ease-in-out infinite;
}

@keyframes pulse-dot {
  0%, 100% { opacity: 1; box-shadow: 0 0 12px var(--teal-glow-strong); }
  50% { opacity: 0.5; box-shadow: 0 0 4px var(--teal-glow); }
}

.nav-links {
  display: flex;
  gap: 32px;
  list-style: none;
}

.nav-links a {
  font-size: 12px;
  color: var(--text-secondary);
  text-decoration: none;
  text-transform: uppercase;
  letter-spacing: 1.5px;
  transition: color 0.3s;
}

.nav-links a:hover { color: var(--teal); }

/* ========== HERO ========== */
.hero {
  position: relative;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  justify-content: center;
  padding: 120px 60px 80px;
  overflow: hidden;
}

.hero-signal-container {
  position: absolute;
  top: 50%;
  right: -5%;
  transform: translateY(-50%);
  width: 700px;
  height: 700px;
  opacity: 0.5;
}

.signal-ring {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  border-radius: 50%;
  border: 1px solid var(--teal);
  opacity: 0;
  animation: signal-propagate 4s ease-out infinite;
}

.signal-ring:nth-child(1) { width: 80px; height: 80px; animation-delay: 0s; }
.signal-ring:nth-child(2) { width: 200px; height: 200px; animation-delay: 0.6s; }
.signal-ring:nth-child(3) { width: 340px; height: 340px; animation-delay: 1.2s; }
.signal-ring:nth-child(4) { width: 500px; height: 500px; animation-delay: 1.8s; }
.signal-ring:nth-child(5) { width: 680px; height: 680px; animation-delay: 2.4s; }

@keyframes signal-propagate {
  0% { opacity: 0.6; transform: translate(-50%, -50%) scale(0.8); }
  100% { opacity: 0; transform: translate(-50%, -50%) scale(1.2); }
}

.signal-center {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 16px;
  height: 16px;
  background: var(--teal);
  border-radius: 50%;
  box-shadow: 0 0 30px var(--teal-glow-strong), 0 0 60px var(--teal-glow);
}

.hero-label {
  font-family: var(--mono);
  font-size: 12px;
  color: var(--teal);
  letter-spacing: 3px;
  text-transform: uppercase;
  margin-bottom: 24px;
  opacity: 0;
  animation: hero-fade 0.8s 0.2s forwards;
}

.hero h1 {
  font-family: var(--mono);
  font-size: clamp(48px, 7vw, 96px);
  font-weight: 500;
  line-height: 1.05;
  max-width: 800px;
  color: var(--text-primary);
  opacity: 0;
  animation: hero-fade 0.8s 0.4s forwards;
}

.hero h1 span {
  color: var(--teal);
  text-shadow: 0 0 40px var(--teal-glow-strong);
}

.hero-desc {
  font-size: 20px;
  color: var(--text-secondary);
  max-width: 580px;
  margin-top: 32px;
  line-height: 1.8;
  opacity: 0;
  animation: hero-fade 0.8s 0.6s forwards;
}

@keyframes hero-fade {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}

.hero-stats {
  display: flex;
  gap: 48px;
  margin-top: 56px;
  opacity: 0;
  animation: hero-fade 0.8s 0.8s forwards;
}

.hero-stat {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.hero-stat-value {
  font-family: var(--mono);
  font-size: 36px;
  font-weight: 500;
  color: var(--teal);
}

.hero-stat-label {
  font-family: var(--mono);
  font-size: 11px;
  color: var(--text-dim);
  letter-spacing: 1.5px;
  text-transform: uppercase;
}

.hero-scroll-hint {
  position: absolute;
  bottom: 40px;
  left: 60px;
  display: flex;
  align-items: center;
  gap: 12px;
  font-family: var(--mono);
  font-size: 11px;
  color: var(--text-dim);
  letter-spacing: 2px;
  text-transform: uppercase;
  opacity: 0;
  animation: hero-fade 0.8s 1.2s forwards;
}

.scroll-line {
  width: 40px;
  height: 1px;
  background: var(--text-dim);
  position: relative;
  overflow: hidden;
}

.scroll-line::after {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: var(--teal);
  animation: scroll-sweep 2s ease-in-out infinite;
}

@keyframes scroll-sweep {
  0% { left: -100%; }
  50% { left: 100%; }
  100% { left: 100%; }
}

/* ========== SECTIONS ========== */
section {
  position: relative;
  z-index: 1;
  padding: 100px 60px;
}

.section-label {
  font-family: var(--mono);
  font-size: 11px;
  color: var(--amber);
  letter-spacing: 3px;
  text-transform: uppercase;
  margin-bottom: 16px;
  display: flex;
  align-items: center;
  gap: 12px;
}

.section-label::before {
  content: '';
  width: 24px;
  height: 1px;
  background: var(--amber);
}

.section-title {
  font-family: var(--mono);
  font-size: clamp(28px, 4vw, 44px);
  font-weight: 500;
  line-height: 1.2;
  max-width: 700px;
  margin-bottom: 24px;
}

.section-desc {
  font-size: 17px;
  color: var(--text-secondary);
  max-width: 620px;
  line-height: 1.8;
  margin-bottom: 56px;
}

/* ========== DIAGONAL DIVIDER ========== */
.diagonal-divider {
  height: 120px;
  background: linear-gradient(172deg, var(--bg-deep) 49.5%, var(--bg-primary) 50.5%);
  position: relative;
  z-index: 1;
}

.diagonal-divider-reverse {
  height: 120px;
  background: linear-gradient(172deg, var(--bg-primary) 49.5%, var(--bg-deep) 50.5%);
  position: relative;
  z-index: 1;
}

/* ========== ARCHITECTURE SECTION ========== */
.arch-section {
  background: var(--bg-primary);
}

.arch-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 20px;
  max-width: 1200px;
}

.arch-card {
  background: var(--bg-card);
  border: 1px solid var(--border);
  padding: 36px 32px;
  position: relative;
  overflow: hidden;
  transition: border-color 0.4s, transform 0.4s, box-shadow 0.4s;
}

.arch-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 2px;
  background: linear-gradient(90deg, var(--teal), transparent);
  opacity: 0;
  transition: opacity 0.4s;
}

.arch-card:hover {
  border-color: var(--border-light);
  transform: translateY(-4px);
  box-shadow: 0 20px 60px rgba(0,0,0,0.3);
}

.arch-card:hover::before { opacity: 1; }

.arch-card-icon {
  font-family: var(--mono);
  font-size: 13px;
  color: var(--teal);
  background: var(--teal-glow);
  padding: 6px 14px;
  display: inline-block;
  margin-bottom: 20px;
  letter-spacing: 1px;
}

.arch-card h3 {
  font-family: var(--mono);
  font-size: 18px;
  font-weight: 500;
  margin-bottom: 12px;
}

.arch-card p {
  font-size: 15px;
  color: var(--text-secondary);
  line-height: 1.7;
}

.arch-card .file-count {
  font-family: var(--mono);
  font-size: 12px;
  color: var(--text-dim);
  margin-top: 16px;
  padding-top: 16px;
  border-top: 1px solid var(--border);
}

.arch-card .file-count span { color: var(--amber); }

/* ========== DATA FLOW SECTION ========== */
.flow-section {
  background: var(--bg-deep);
}

.flow-diagram {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0;
  max-width: 1200px;
  margin: 0 auto;
  flex-wrap: wrap;
}

.flow-node {
  background: var(--bg-card);
  border: 1px solid var(--border);
  padding: 32px 28px;
  min-width: 200px;
  text-align: center;
  position: relative;
  transition: border-color 0.3s, box-shadow 0.3s;
}

.flow-node:hover {
  border-color: var(--teal-dim);
  box-shadow: 0 0 30px var(--teal-glow);
}

.flow-node-label {
  font-family: var(--mono);
  font-size: 11px;
  color: var(--text-dim);
  letter-spacing: 2px;
  text-transform: uppercase;
  margin-bottom: 8px;
}

.flow-node-title {
  font-family: var(--mono);
  font-size: 18px;
  font-weight: 500;
  color: var(--text-primary);
}

.flow-node-desc {
  font-size: 13px;
  color: var(--text-secondary);
  margin-top: 8px;
  line-height: 1.6;
}

.flow-node.core {
  background: linear-gradient(135deg, var(--bg-card), #0d1f2d);
  border-color: var(--teal-dim);
  padding: 40px 36px;
  min-width: 280px;
  box-shadow: 0 0 40px var(--teal-glow);
}

.flow-node.core .flow-node-title { color: var(--teal); font-size: 22px; }

.flow-arrow {
  display: flex;
  align-items: center;
  padding: 0 8px;
  color: var(--text-dim);
  font-family: var(--mono);
  font-size: 22px;
  position: relative;
}

.flow-arrow-line {
  width: 60px;
  height: 1px;
  background: linear-gradient(90deg, var(--teal-dim), var(--teal));
  position: relative;
}

.flow-arrow-line::after {
  content: '';
  position: absolute;
  right: -1px;
  top: -4px;
  width: 0;
  height: 0;
  border-left: 8px solid var(--teal);
  border-top: 5px solid transparent;
  border-bottom: 5px solid transparent;
}

.flow-arrow-label {
  position: absolute;
  top: -18px;
  left: 50%;
  transform: translateX(-50%);
  font-family: var(--mono);
  font-size: 9px;
  color: var(--teal-dim);
  letter-spacing: 2px;
  text-transform: uppercase;
  white-space: nowrap;
}

.flow-packet {
  position: absolute;
  top: -1px;
  left: -10px;
  width: 10px;
  height: 3px;
  background: var(--teal);
  box-shadow: 0 0 8px var(--teal);
  animation: packet-move 2.5s ease-in-out infinite;
}

@keyframes packet-move {
  0% { left: -10px; opacity: 0; }
  10% { opacity: 1; }
  90% { opacity: 1; }
  100% { left: 60px; opacity: 0; }
}

/* ========== INTEGRATIONS ========== */
.integrations-section {
  background: var(--bg-primary);
}

.integration-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: 12px;
  max-width: 1200px;
}

.integration-chip {
  font-family: var(--mono);
  font-size: 13px;
  padding: 16px 20px;
  background: var(--bg-card);
  border: 1px solid var(--border);
  color: var(--text-secondary);
  display: flex;
  align-items: center;
  gap: 10px;
  transition: all 0.3s;
  cursor: default;
}

.integration-chip:hover {
  border-color: var(--border-light);
  color: var(--text-primary);
  background: var(--bg-card-hover);
}

.integration-chip .chip-dot {
  width: 6px;
  height: 6px;
  border-radius: 50%;
  flex-shrink: 0;
}

.chip-dot.global { background: var(--teal); box-shadow: 0 0 6px var(--teal-glow-strong); }
.chip-dot.per-app { background: var(--amber); box-shadow: 0 0 6px var(--amber-glow); }

.integration-legend {
  display: flex;
  gap: 32px;
  margin-bottom: 32px;
  font-family: var(--mono);
  font-size: 12px;
  color: var(--text-dim);
}

.legend-item {
  display: flex;
  align-items: center;
  gap: 8px;
}

/* ========== COMPONENTS ========== */
.components-section {
  background: var(--bg-deep);
}

.component-row {
  display: grid;
  grid-template-columns: 300px 1fr;
  gap: 60px;
  max-width: 1200px;
  margin-bottom: 64px;
  align-items: start;
}

.component-row:last-child { margin-bottom: 0; }

.component-header {
  position: sticky;
  top: 100px;
}

.component-header h3 {
  font-family: var(--mono);
  font-size: 22px;
  font-weight: 500;
  margin-bottom: 12px;
}

.component-header p {
  font-size: 15px;
  color: var(--text-secondary);
  line-height: 1.7;
}

.component-details {
  display: grid;
  gap: 12px;
}

.component-detail-item {
  display: flex;
  gap: 16px;
  padding: 20px 24px;
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-left: 2px solid var(--teal);
  transition: background 0.3s;
}

.component-detail-item:hover { background: var(--bg-card-hover); }

.component-detail-item .idx {
  font-family: var(--mono);
  font-size: 12px;
  color: var(--teal-dim);
  flex-shrink: 0;
  padding-top: 2px;
}

.component-detail-item h4 {
  font-family: var(--mono);
  font-size: 14px;
  font-weight: 500;
  margin-bottom: 4px;
}

.component-detail-item p {
  font-size: 14px;
  color: var(--text-secondary);
  line-height: 1.6;
}

/* ========== SCENARIOS ========== */
.scenarios-section {
  background: var(--bg-primary);
}

.scenario-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 20px;
  max-width: 1200px;
}

.scenario-card {
  background: var(--bg-card);
  border: 1px solid var(--border);
  padding: 40px 36px;
  position: relative;
  overflow: hidden;
  transition: all 0.4s;
}

.scenario-card::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  height: 2px;
  background: linear-gradient(90deg, transparent, var(--teal), transparent);
  opacity: 0;
  transition: opacity 0.4s;
}

.scenario-card:hover {
  border-color: var(--border-light);
  transform: translateY(-2px);
  box-shadow: 0 16px 48px rgba(0,0,0,0.25);
}

.scenario-card:hover::after { opacity: 1; }

.scenario-number {
  font-family: var(--mono);
  font-size: 48px;
  font-weight: 300;
  color: var(--bg-raised);
  position: absolute;
  top: 20px;
  right: 28px;
  line-height: 1;
  user-select: none;
}

.scenario-card:hover .scenario-number { color: var(--border); }

.scenario-tag {
  font-family: var(--mono);
  font-size: 10px;
  letter-spacing: 2px;
  text-transform: uppercase;
  color: var(--teal);
  background: var(--teal-glow);
  padding: 4px 12px;
  display: inline-block;
  margin-bottom: 16px;
}

.scenario-card h3 {
  font-family: var(--mono);
  font-size: 20px;
  font-weight: 500;
  margin-bottom: 12px;
}

.scenario-card p {
  font-size: 15px;
  color: var(--text-secondary);
  line-height: 1.7;
  margin-bottom: 16px;
}

.scenario-why {
  font-size: 13px;
  color: var(--text-dim);
  line-height: 1.7;
  padding-top: 16px;
  border-top: 1px solid var(--border);
}

.scenario-why strong {
  color: var(--amber);
  font-weight: 400;
}

/* ========== DEPLOYMENT ========== */
.deploy-section {
  background: var(--bg-deep);
}

.deploy-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 20px;
  max-width: 1200px;
}

.deploy-card {
  background: var(--bg-card);
  border: 1px solid var(--border);
  padding: 32px 28px;
  text-align: center;
  transition: all 0.4s;
  position: relative;
}

.deploy-card:hover {
  border-color: var(--teal-dim);
  box-shadow: 0 0 30px var(--teal-glow);
  transform: translateY(-4px);
}

.deploy-icon {
  font-family: var(--mono);
  font-size: 32px;
  margin-bottom: 16px;
  display: block;
  color: var(--teal);
}

.deploy-card h3 {
  font-family: var(--mono);
  font-size: 16px;
  font-weight: 500;
  margin-bottom: 8px;
}

.deploy-card p {
  font-size: 13px;
  color: var(--text-secondary);
  line-height: 1.6;
}

.deploy-card .deploy-db {
  font-family: var(--mono);
  font-size: 11px;
  color: var(--amber);
  margin-top: 12px;
  letter-spacing: 0.5px;
}

.deploy-platforms {
  max-width: 1200px;
  margin-top: 40px;
  padding: 28px 32px;
  background: var(--bg-card);
  border: 1px solid var(--border);
  display: flex;
  align-items: center;
  gap: 40px;
}

.deploy-platforms-label {
  font-family: var(--mono);
  font-size: 11px;
  color: var(--text-dim);
  letter-spacing: 2px;
  text-transform: uppercase;
  flex-shrink: 0;
}

.platform-tags {
  display: flex;
  gap: 12px;
  flex-wrap: wrap;
}

.platform-tag {
  font-family: var(--mono);
  font-size: 13px;
  color: var(--text-secondary);
  padding: 6px 16px;
  border: 1px solid var(--border);
  background: var(--bg-raised);
}

/* ========== STATS BAR ========== */
.stats-bar {
  background: var(--bg-primary);
  border-top: 1px solid var(--border);
  border-bottom: 1px solid var(--border);
  padding: 48px 60px;
  position: relative;
  z-index: 1;
}

.stats-inner {
  display: grid;
  grid-template-columns: repeat(6, 1fr);
  gap: 32px;
  max-width: 1200px;
}

.stat-item {
  text-align: center;
}

.stat-value {
  font-family: var(--mono);
  font-size: 32px;
  font-weight: 500;
  color: var(--teal);
  display: block;
}

.stat-label {
  font-family: var(--mono);
  font-size: 11px;
  color: var(--text-dim);
  letter-spacing: 1.5px;
  text-transform: uppercase;
  margin-top: 4px;
}

/* ========== API LANGUAGES ========== */
.api-section {
  background: var(--bg-primary);
}

.lang-grid {
  display: flex;
  flex-wrap: wrap;
  gap: 12px;
  max-width: 1200px;
}

.lang-tag {
  font-family: var(--mono);
  font-size: 14px;
  padding: 12px 24px;
  background: var(--bg-card);
  border: 1px solid var(--border);
  color: var(--text-secondary);
  transition: all 0.3s;
  cursor: default;
}

.lang-tag:hover {
  border-color: var(--teal-dim);
  color: var(--teal);
  background: var(--teal-glow);
}

/* ========== FOOTER ========== */
footer {
  position: relative;
  z-index: 1;
  background: var(--bg-deep);
  border-top: 1px solid var(--border);
  padding: 48px 60px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.footer-left {
  font-family: var(--mono);
  font-size: 14px;
  color: var(--text-dim);
}

.footer-left a {
  color: var(--teal-dim);
  text-decoration: none;
  transition: color 0.3s;
}

.footer-left a:hover { color: var(--teal); }

.footer-right {
  font-family: var(--mono);
  font-size: 11px;
  color: var(--text-dim);
  letter-spacing: 1px;
}

/* ========== CIRCUIT TRACES (decorative) ========== */
.circuit-trace {
  position: absolute;
  background: var(--border);
  z-index: 0;
}

.circuit-trace.horizontal {
  height: 1px;
  width: 200px;
}

.circuit-trace.vertical {
  width: 1px;
  height: 150px;
}

.circuit-node {
  position: absolute;
  width: 6px;
  height: 6px;
  border: 1px solid var(--teal-dim);
  border-radius: 50%;
  z-index: 0;
}

/* ========== FLOW SIMULATION ========== */
.flow-controls {
  display: flex;
  gap: 12px;
  margin-bottom: 32px;
  justify-content: center;
}

.flow-control-btn {
  font-family: var(--mono);
  font-size: 13px;
  padding: 10px 24px;
  border: 1px solid var(--border-light);
  background: var(--bg-card);
  color: var(--text-secondary);
  cursor: pointer;
  transition: all 0.3s;
  letter-spacing: 0.5px;
}

.flow-control-btn:hover {
  border-color: var(--teal-dim);
  color: var(--teal);
  background: var(--teal-glow);
}

.flow-control-btn:disabled {
  opacity: 0.4;
  cursor: not-allowed;
}

.flow-control-btn.primary {
  border-color: var(--teal-dim);
  color: var(--teal);
  background: var(--teal-glow);
}

.flow-control-btn.primary:hover {
  background: var(--teal-glow-strong);
}

.stage-active {
  border-color: var(--teal) !important;
  box-shadow: 0 0 40px var(--teal-glow-strong), 0 0 80px var(--teal-glow) !important;
  transform: scale(1.04);
}

.stage-complete {
  border-color: var(--teal-dim) !important;
  background: linear-gradient(135deg, var(--bg-card), rgba(0,229,199,0.05)) !important;
}

.stage-complete .flow-node-title { color: var(--teal-dim); }

.stage-metadata {
  font-family: var(--mono);
  font-size: 11px;
  color: var(--teal);
  margin-top: 10px;
  padding-top: 10px;
  border-top: 1px solid var(--border);
  line-height: 1.6;
  opacity: 0;
  max-height: 0;
  overflow: hidden;
  transition: opacity 0.4s, max-height 0.4s;
}

.stage-active .stage-metadata,
.stage-complete .stage-metadata {
  opacity: 1;
  max-height: 120px;
}

.simulation-log-panel {
  max-width: 1200px;
  margin: 32px auto 0;
  background: var(--bg-card);
  border: 1px solid var(--border);
  max-height: 240px;
  overflow-y: auto;
  font-family: var(--mono);
  font-size: 12px;
}

.simulation-log-panel::-webkit-scrollbar { width: 6px; }
.simulation-log-panel::-webkit-scrollbar-track { background: var(--bg-card); }
.simulation-log-panel::-webkit-scrollbar-thumb { background: var(--border-light); }

.log-panel-header {
  position: sticky;
  top: 0;
  padding: 10px 16px;
  background: var(--bg-raised);
  border-bottom: 1px solid var(--border);
  color: var(--text-dim);
  font-size: 10px;
  letter-spacing: 2px;
  text-transform: uppercase;
  z-index: 2;
}

.log-entry {
  padding: 6px 16px;
  border-bottom: 1px solid rgba(26,36,53,0.5);
  color: var(--text-secondary);
  display: flex;
  gap: 12px;
  animation: logSlideIn 0.3s ease-out;
}

@keyframes logSlideIn {
  from { opacity: 0; transform: translateX(-10px); }
  to { opacity: 1; transform: translateX(0); }
}

.log-entry .log-time { color: var(--text-dim); flex-shrink: 0; }
.log-entry .log-stage { color: var(--teal); flex-shrink: 0; min-width: 80px; }
.log-entry .log-msg { color: var(--text-secondary); }

/* ========== PACKET SIMULATOR ========== */
.simulator-section {
  background: var(--bg-deep);
}

.frame-type-selector {
  display: flex;
  gap: 0;
  margin-bottom: 40px;
  max-width: 1200px;
  border: 1px solid var(--border);
}

.frame-type-btn {
  font-family: var(--mono);
  font-size: 13px;
  padding: 12px 24px;
  background: var(--bg-card);
  border: none;
  border-right: 1px solid var(--border);
  color: var(--text-secondary);
  cursor: pointer;
  flex: 1;
  transition: all 0.3s;
  letter-spacing: 0.5px;
}

.frame-type-btn:last-child { border-right: none; }

.frame-type-btn:hover {
  color: var(--text-primary);
  background: var(--bg-card-hover);
}

.frame-type-btn.active {
  color: var(--teal);
  background: var(--teal-glow);
  box-shadow: inset 0 -2px 0 var(--teal);
}

.simulator-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 24px;
  max-width: 1200px;
}

.byte-grid-panel {
  background: var(--bg-card);
  border: 1px solid var(--border);
  padding: 24px;
}

.byte-grid-panel h4 {
  font-family: var(--mono);
  font-size: 12px;
  color: var(--text-dim);
  letter-spacing: 2px;
  text-transform: uppercase;
  margin-bottom: 16px;
}

.byte-grid {
  display: flex;
  flex-wrap: wrap;
  gap: 4px;
}

.byte-block {
  width: 48px;
  height: 48px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-family: var(--mono);
  font-size: 13px;
  font-weight: 500;
  border: 1px solid var(--border);
  cursor: pointer;
  transition: all 0.2s;
  position: relative;
}

.byte-block:hover {
  transform: scale(1.1);
  z-index: 2;
}

.byte-block.selected {
  transform: scale(1.12);
  z-index: 3;
  box-shadow: 0 0 20px rgba(0,0,0,0.5);
}

.byte-block.mhdr { background: rgba(245,166,35,0.2); color: var(--amber); border-color: var(--amber-dim); }
.byte-block.mhdr.selected { box-shadow: 0 0 20px var(--amber-glow); }
.byte-block.devaddr { background: rgba(0,229,199,0.12); color: var(--teal); border-color: var(--teal-dim); }
.byte-block.devaddr.selected { box-shadow: 0 0 20px var(--teal-glow); }
.byte-block.fctrl { background: rgba(232,98,44,0.15); color: var(--rust-orange); border-color: var(--rust-orange); }
.byte-block.fctrl.selected { box-shadow: 0 0 20px rgba(232,98,44,0.3); }
.byte-block.fcnt { background: rgba(80,140,255,0.12); color: #509cff; border-color: #3a7bdf; }
.byte-block.fcnt.selected { box-shadow: 0 0 20px rgba(80,140,255,0.3); }
.byte-block.fport { background: rgba(180,100,255,0.12); color: #b464ff; border-color: #9645e0; }
.byte-block.fport.selected { box-shadow: 0 0 20px rgba(180,100,255,0.3); }
.byte-block.payload { background: rgba(0,200,120,0.1); color: #00c878; border-color: #00a060; }
.byte-block.payload.selected { box-shadow: 0 0 20px rgba(0,200,120,0.3); }
.byte-block.mic { background: rgba(255,60,60,0.12); color: #ff5050; border-color: #cc3333; }
.byte-block.mic.selected { box-shadow: 0 0 20px rgba(255,60,60,0.3); }
.byte-block.joineui { background: rgba(0,229,199,0.12); color: var(--teal); border-color: var(--teal-dim); }
.byte-block.joineui.selected { box-shadow: 0 0 20px var(--teal-glow); }
.byte-block.deveui { background: rgba(80,140,255,0.12); color: #509cff; border-color: #3a7bdf; }
.byte-block.deveui.selected { box-shadow: 0 0 20px rgba(80,140,255,0.3); }
.byte-block.devnonce { background: rgba(180,100,255,0.12); color: #b464ff; border-color: #9645e0; }
.byte-block.devnonce.selected { box-shadow: 0 0 20px rgba(180,100,255,0.3); }
.byte-block.joinnonce { background: rgba(0,200,120,0.1); color: #00c878; border-color: #00a060; }
.byte-block.joinnonce.selected { box-shadow: 0 0 20px rgba(0,200,120,0.3); }
.byte-block.homenetid { background: rgba(232,98,44,0.15); color: var(--rust-orange); border-color: var(--rust-orange); }
.byte-block.homenetid.selected { box-shadow: 0 0 20px rgba(232,98,44,0.3); }
.byte-block.dlsettings { background: rgba(180,100,255,0.12); color: #b464ff; border-color: #9645e0; }
.byte-block.dlsettings.selected { box-shadow: 0 0 20px rgba(180,100,255,0.3); }
.byte-block.rxdelay { background: rgba(80,140,255,0.12); color: #509cff; border-color: #3a7bdf; }
.byte-block.rxdelay.selected { box-shadow: 0 0 20px rgba(80,140,255,0.3); }

.byte-block-label {
  position: absolute;
  bottom: -16px;
  left: 50%;
  transform: translateX(-50%);
  font-size: 8px;
  color: var(--text-dim);
  white-space: nowrap;
  pointer-events: none;
}

.bit-breakdown-panel {
  background: var(--bg-card);
  border: 1px solid var(--border);
  padding: 24px;
}

.bit-breakdown-panel h4 {
  font-family: var(--mono);
  font-size: 12px;
  color: var(--text-dim);
  letter-spacing: 2px;
  text-transform: uppercase;
  margin-bottom: 16px;
}

.bit-breakdown-empty {
  color: var(--text-dim);
  font-family: var(--mono);
  font-size: 13px;
  padding: 40px 0;
  text-align: center;
}

.bit-field {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px 14px;
  margin-bottom: 6px;
  background: var(--bg-raised);
  border: 1px solid var(--border);
  font-family: var(--mono);
  font-size: 13px;
}

.bit-field-name { color: var(--text-primary); }
.bit-field-bits { color: var(--teal-dim); font-size: 11px; }
.bit-field-value { color: var(--amber); }
.bit-field-desc {
  font-size: 11px;
  color: var(--text-dim);
  margin-top: 4px;
  padding: 0 14px 8px;
  line-height: 1.5;
}

.raw-hex-output {
  max-width: 1200px;
  margin-top: 24px;
  background: var(--bg-card);
  border: 1px solid var(--border);
  padding: 16px 20px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 16px;
}

.raw-hex-output .hex-label {
  font-family: var(--mono);
  font-size: 10px;
  color: var(--text-dim);
  letter-spacing: 2px;
  text-transform: uppercase;
  flex-shrink: 0;
}

.raw-hex-output .hex-value {
  font-family: var(--mono);
  font-size: 14px;
  color: var(--teal);
  word-break: break-all;
  flex: 1;
}

.raw-hex-output .copy-btn {
  font-family: var(--mono);
  font-size: 12px;
  padding: 6px 16px;
  border: 1px solid var(--border-light);
  background: var(--bg-raised);
  color: var(--text-secondary);
  cursor: pointer;
  transition: all 0.3s;
  flex-shrink: 0;
}

.raw-hex-output .copy-btn:hover {
  border-color: var(--teal-dim);
  color: var(--teal);
}

.packet-legend {
  display: flex;
  flex-wrap: wrap;
  gap: 16px;
  max-width: 1200px;
  margin-top: 20px;
  font-family: var(--mono);
  font-size: 11px;
}

.legend-swatch {
  display: flex;
  align-items: center;
  gap: 6px;
  color: var(--text-dim);
}

.legend-swatch .swatch {
  width: 14px;
  height: 14px;
  border: 1px solid;
}

.swatch.mhdr { background: rgba(245,166,35,0.2); border-color: var(--amber-dim); }
.swatch.devaddr { background: rgba(0,229,199,0.12); border-color: var(--teal-dim); }
.swatch.fctrl { background: rgba(232,98,44,0.15); border-color: var(--rust-orange); }
.swatch.fcnt { background: rgba(80,140,255,0.12); border-color: #3a7bdf; }
.swatch.fport { background: rgba(180,100,255,0.12); border-color: #9645e0; }
.swatch.payload { background: rgba(0,200,120,0.1); border-color: #00a060; }
.swatch.mic { background: rgba(255,60,60,0.12); border-color: #cc3333; }

/* ========== CONFIG BUILDER ========== */
.config-section {
  background: var(--bg-primary);
}

.config-container {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 24px;
  max-width: 1200px;
}

.config-form-panel {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.config-section-block {
  border: 1px solid var(--border);
  background: var(--bg-card);
}

.config-section-header {
  font-family: var(--mono);
  font-size: 14px;
  padding: 14px 20px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: space-between;
  color: var(--text-primary);
  transition: background 0.3s;
  user-select: none;
}

.config-section-header:hover { background: var(--bg-card-hover); }

.config-section-header .toggle-icon {
  color: var(--text-dim);
  font-size: 12px;
  transition: transform 0.3s;
}

.config-section-header .toggle-icon.open { transform: rotate(180deg); }

.config-section-body {
  padding: 0 20px;
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.4s ease, padding 0.4s ease;
}

.config-section-body.open {
  padding: 16px 20px;
  max-height: 800px;
}

.form-group {
  margin-bottom: 14px;
}

.form-group label {
  font-family: var(--mono);
  font-size: 12px;
  color: var(--text-dim);
  letter-spacing: 0.5px;
  display: block;
  margin-bottom: 6px;
}

.form-input {
  font-family: var(--mono);
  font-size: 13px;
  padding: 8px 12px;
  width: 100%;
  background: var(--bg-raised);
  border: 1px solid var(--border);
  color: var(--text-primary);
  outline: none;
  transition: border-color 0.3s;
}

.form-input:focus { border-color: var(--teal-dim); }

.radio-group {
  display: flex;
  gap: 16px;
  margin-bottom: 12px;
}

.radio-group label {
  font-family: var(--mono);
  font-size: 13px;
  color: var(--text-secondary);
  display: flex;
  align-items: center;
  gap: 6px;
  cursor: pointer;
}

.radio-group input[type="radio"] {
  accent-color: var(--teal);
}

.checkbox-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 6px;
}

.checkbox-grid label {
  font-family: var(--mono);
  font-size: 12px;
  color: var(--text-secondary);
  display: flex;
  align-items: center;
  gap: 6px;
  cursor: pointer;
}

.checkbox-grid input[type="checkbox"] {
  accent-color: var(--teal);
}

.conditional-field {
  display: none;
}

.conditional-field.visible {
  display: block;
}

.integration-config {
  display: none;
  margin-top: 10px;
  padding: 12px;
  background: var(--bg-raised);
  border: 1px solid var(--border);
}

.integration-config.visible { display: block; }

.integration-config .form-group:last-child { margin-bottom: 0; }

.config-preview-panel {
  position: sticky;
  top: 80px;
  max-height: calc(100vh - 120px);
  display: flex;
  flex-direction: column;
  background: var(--bg-card);
  border: 1px solid var(--border);
}

.config-preview-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 20px;
  border-bottom: 1px solid var(--border);
  flex-shrink: 0;
}

.config-preview-header span {
  font-family: var(--mono);
  font-size: 10px;
  color: var(--text-dim);
  letter-spacing: 2px;
  text-transform: uppercase;
}

.config-preview-actions {
  display: flex;
  gap: 8px;
}

.config-preview-actions button {
  font-family: var(--mono);
  font-size: 11px;
  padding: 5px 14px;
  border: 1px solid var(--border-light);
  background: var(--bg-raised);
  color: var(--text-secondary);
  cursor: pointer;
  transition: all 0.3s;
}

.config-preview-actions button:hover {
  border-color: var(--teal-dim);
  color: var(--teal);
}

.toml-preview {
  flex: 1;
  overflow-y: auto;
  padding: 16px 20px;
  font-family: var(--mono);
  font-size: 13px;
  line-height: 1.7;
  white-space: pre;
  color: var(--text-primary);
}

.toml-preview::-webkit-scrollbar { width: 6px; }
.toml-preview::-webkit-scrollbar-track { background: var(--bg-card); }
.toml-preview::-webkit-scrollbar-thumb { background: var(--border-light); }

.toml-section { color: var(--teal); }
.toml-key { color: var(--text-primary); }
.toml-string { color: var(--teal-dim); }
.toml-number { color: var(--amber); }
.toml-boolean { color: var(--rust-orange); }
.toml-comment { color: var(--text-dim); font-style: italic; }

.generate-btn {
  font-family: var(--mono);
  font-size: 11px;
  padding: 5px 12px;
  border: 1px solid var(--border-light);
  background: var(--bg-raised);
  color: var(--text-secondary);
  cursor: pointer;
  transition: all 0.3s;
  margin-left: 8px;
}

.generate-btn:hover {
  border-color: var(--teal-dim);
  color: var(--teal);
}

/* ========== RESPONSIVE ========== */
@media (max-width: 1024px) {
  .arch-grid { grid-template-columns: repeat(2, 1fr); }
  .scenario-grid { grid-template-columns: 1fr; }
  .deploy-grid { grid-template-columns: repeat(2, 1fr); }
  .stats-inner { grid-template-columns: repeat(3, 1fr); gap: 24px; }
  .component-row { grid-template-columns: 1fr; gap: 24px; }
  .component-header { position: static; }
  .flow-diagram { flex-direction: column; }
  .flow-arrow { transform: rotate(90deg); padding: 8px 0; }
  .simulator-grid { grid-template-columns: 1fr; }
  .config-container { grid-template-columns: 1fr; }
  .config-preview-panel { position: static; max-height: 500px; }
}

@media (max-width: 768px) {
  nav { padding: 0 24px; }
  .nav-links { display: none; }
  .hero { padding: 100px 24px 60px; }
  section { padding: 60px 24px; }
  .hero-stats { flex-wrap: wrap; gap: 24px; }
  .arch-grid { grid-template-columns: 1fr; }
  .deploy-grid { grid-template-columns: 1fr; }
  .stats-inner { grid-template-columns: repeat(2, 1fr); }
  footer { flex-direction: column; gap: 16px; text-align: center; }
  .deploy-platforms { flex-direction: column; gap: 16px; }
  .stats-bar { padding: 36px 24px; }
  .hero-signal-container { display: none; }
  .hero-scroll-hint { display: none; }
  .byte-block { width: 36px; height: 36px; font-size: 11px; }
  .flow-controls { flex-direction: column; align-items: center; }
  .checkbox-grid { grid-template-columns: 1fr; }
  .frame-type-selector { flex-direction: column; }
  .frame-type-btn { border-right: none; border-bottom: 1px solid var(--border); }
  .frame-type-btn:last-child { border-bottom: none; }
}
</style>
</head>
<body>

<div class="grid-bg"></div>

<!-- ========== NAV ========== -->
<nav>
  <div class="nav-logo">
    <span class="dot"></span>
    chirpstack // network-server
  </div>
  <ul class="nav-links">
    <li><a href="#architecture">Architecture</a></li>
    <li><a href="#flow">Data Flow</a></li>
    <li><a href="#components">Components</a></li>
    <li><a href="#integrations">Integrations</a></li>
    <li><a href="#scenarios">Scenarios</a></li>
    <li><a href="#deploy">Deploy</a></li>
    <li><a href="#packet-simulator">Simulator</a></li>
    <li><a href="#config-builder">Config</a></li>
  </ul>
</nav>

<!-- ========== HERO ========== -->
<section class="hero">
  <div class="hero-signal-container">
    <div class="signal-center"></div>
    <div class="signal-ring"></div>
    <div class="signal-ring"></div>
    <div class="signal-ring"></div>
    <div class="signal-ring"></div>
    <div class="signal-ring"></div>
  </div>

  <div class="hero-label">Open-Source LoRaWAN Network Server</div>
  <h1>The brain behind your <span>IoT network</span></h1>
  <p class="hero-desc">
    ChirpStack is a full-featured, open-source LoRaWAN Network Server written in Rust.
    It manages devices, processes radio frames, handles the LoRaWAN protocol, and delivers
    data to your applications and cloud services.
  </p>

  <div class="hero-stats">
    <div class="hero-stat">
      <span class="hero-stat-value">v4.16</span>
      <span class="hero-stat-label">Latest Release</span>
    </div>
    <div class="hero-stat">
      <span class="hero-stat-value">Rust</span>
      <span class="hero-stat-label">Core Language</span>
    </div>
    <div class="hero-stat">
      <span class="hero-stat-value">MIT</span>
      <span class="hero-stat-label">License</span>
    </div>
    <div class="hero-stat">
      <span class="hero-stat-value">6</span>
      <span class="hero-stat-label">Workspace Crates</span>
    </div>
  </div>

  <div class="hero-scroll-hint">
    <div class="scroll-line"></div>
    Scroll to explore
  </div>
</section>

<!-- ========== STATS BAR ========== -->
<div class="stats-bar">
  <div class="stats-inner reveal">
    <div class="stat-item">
      <span class="stat-value" data-count="242">0</span>
      <span class="stat-label">Rust Files</span>
    </div>
    <div class="stat-item">
      <span class="stat-value" data-count="168">0</span>
      <span class="stat-label">TypeScript Files</span>
    </div>
    <div class="stat-item">
      <span class="stat-value" data-count="12">0</span>
      <span class="stat-label">LoRaWAN Regions</span>
    </div>
    <div class="stat-item">
      <span class="stat-value" data-count="18">0</span>
      <span class="stat-label">Integrations</span>
    </div>
    <div class="stat-item">
      <span class="stat-value" data-count="10">0</span>
      <span class="stat-label">API Languages</span>
    </div>
    <div class="stat-item">
      <span class="stat-value" data-count="19">0</span>
      <span class="stat-label">Proto Definitions</span>
    </div>
  </div>
</div>

<!-- ========== ARCHITECTURE ========== -->
<section class="arch-section" id="architecture">
  <div class="section-label reveal">// 01</div>
  <h2 class="section-title reveal reveal-delay-1">Repository Architecture</h2>
  <p class="section-desc reveal reveal-delay-2">
    A Rust workspace of 6 crates, a React/TypeScript web UI, and Protocol Buffer API definitions
    with generated bindings in 10 programming languages.
  </p>

  <div class="arch-grid">
    <div class="arch-card reveal reveal-delay-1">
      <span class="arch-card-icon">chirpstack/</span>
      <h3>Network Server Core</h3>
      <p>The main application crate. Handles uplink/downlink processing, device management, MAC commands, gRPC API, storage, and all integration dispatch.</p>
      <div class="file-count"><span>192</span> Rust source files &middot; <span>29</span> PG migrations</div>
    </div>
    <div class="arch-card reveal reveal-delay-2">
      <span class="arch-card-icon">lrwn/</span>
      <h3>LoRaWAN Frame Library</h3>
      <p>Standalone library for encoding and decoding LoRaWAN physical payloads, MAC commands, cryptographic operations, and regional parameter sets.</p>
      <div class="file-count"><span>20</span> source files &middot; <span>12</span> region implementations</div>
    </div>
    <div class="arch-card reveal reveal-delay-3">
      <span class="arch-card-icon">api/</span>
      <h3>API & Proto Definitions</h3>
      <p>Protocol Buffer definitions for 10 gRPC services, plus generated client/server code for Rust, Go, Python, Java, Kotlin, C#, PHP, C, JS, and TypeScript.</p>
      <div class="file-count"><span>19</span> proto files &middot; <span>10</span> language bindings</div>
    </div>
    <div class="arch-card reveal reveal-delay-4">
      <span class="arch-card-icon">ui/</span>
      <h3>Web Interface</h3>
      <p>React 18 + TypeScript admin dashboard with Ant Design, Leaflet maps, Chart.js metrics, Ace code editor, and gRPC-Web for browser communication.</p>
      <div class="file-count"><span>168</span> TypeScript files &middot; Vite build</div>
    </div>
    <div class="arch-card reveal reveal-delay-5">
      <span class="arch-card-icon">backend/</span>
      <h3>Gateway Backend</h3>
      <p>Library handling gateway-to-server communication, key wrapping for secure joins, and HTTP client logic for LoRaWAN Backend Interfaces.</p>
      <div class="file-count"><span>48KB</span> core library</div>
    </div>
    <div class="arch-card reveal reveal-delay-6">
      <span class="arch-card-icon">lrwn-filters/</span>
      <h3>Payload Filters</h3>
      <p>Utility library for filtering LoRaWAN payloads based on DevAddr and JoinEUI prefix ranges. Used for routing and roaming decisions.</p>
      <div class="file-count">Focused utility crate</div>
    </div>
  </div>
</section>

<div class="diagonal-divider"></div>

<!-- ========== DATA FLOW ========== -->
<section class="flow-section" id="flow">
  <div class="section-label reveal">// 02</div>
  <h2 class="section-title reveal reveal-delay-1">Data Flow Pipeline</h2>
  <p class="section-desc reveal reveal-delay-2">
    Radio packets travel from IoT sensors through gateways into ChirpStack's processing engine,
    emerging as structured, decoded events delivered to your applications.
  </p>

  <div class="flow-controls reveal reveal-delay-3">
    <button class="flow-control-btn primary" id="btn-simulate" onclick="flowSimulator.start()">Simulate Uplink</button>
    <button class="flow-control-btn" id="btn-reset" onclick="flowSimulator.reset()">Reset</button>
  </div>

  <div class="flow-diagram reveal reveal-delay-3">
    <div class="flow-node" data-stage="1" id="flow-stage-1">
      <div class="flow-node-label">Source</div>
      <div class="flow-node-title">IoT Sensors</div>
      <div class="flow-node-desc">LoRaWAN Class A/B/C<br>end-devices</div>
      <div class="stage-metadata">SF7 BW125 868.1MHz<br>14 dBm TX Power<br>DevAddr: 01ABCDEF</div>
    </div>

    <div class="flow-arrow">
      <div class="flow-arrow-line">
        <div class="flow-packet"></div>
        <span class="flow-arrow-label">Radio / RF</span>
      </div>
    </div>

    <div class="flow-node" data-stage="2" id="flow-stage-2">
      <div class="flow-node-label">Relay</div>
      <div class="flow-node-title">Gateways</div>
      <div class="flow-node-desc">Receive &amp; forward<br>raw LoRa frames</div>
      <div class="stage-metadata">RSSI: -72 dBm<br>SNR: 8.5 dB<br>3 gateways received</div>
    </div>

    <div class="flow-arrow">
      <div class="flow-arrow-line">
        <div class="flow-packet" style="animation-delay: 0.4s;"></div>
        <span class="flow-arrow-label">UDP / MQTT</span>
      </div>
    </div>

    <div class="flow-node core" data-stage="3" id="flow-stage-3">
      <div class="flow-node-label">Core Engine</div>
      <div class="flow-node-title">ChirpStack</div>
      <div class="flow-node-desc">Dedup, decrypt, MAC processing,<br>ADR, session management,<br>payload decoding</div>
      <div class="stage-metadata" id="core-stage-meta">Dedup: 3 frames &rarr; 1<br>Best RSSI: GW-0a2b (-72dBm)</div>
    </div>

    <div class="flow-arrow">
      <div class="flow-arrow-line">
        <div class="flow-packet" style="animation-delay: 0.8s;"></div>
        <span class="flow-arrow-label">Events</span>
      </div>
    </div>

    <div class="flow-node" data-stage="6" id="flow-stage-6">
      <div class="flow-node-label">Destination</div>
      <div class="flow-node-title">Integrations</div>
      <div class="flow-node-desc">MQTT, Kafka, HTTP,<br>AWS, Azure, GCP&hellip;</div>
      <div class="stage-metadata">MQTT: published to<br>application/1/device/01ab/event/up</div>
    </div>
  </div>

  <div class="simulation-log-panel reveal reveal-delay-4" id="flow-log-panel">
    <div class="log-panel-header">Simulation Log</div>
    <div id="flow-log-entries"></div>
  </div>
</section>

<div class="diagonal-divider-reverse"></div>

<!-- ========== CORE COMPONENTS ========== -->
<section class="components-section" id="components">
  <div class="section-label reveal">// 03</div>
  <h2 class="section-title reveal reveal-delay-1">Core Components</h2>
  <p class="section-desc reveal reveal-delay-2">
    Inside the network server, specialized subsystems handle every aspect of LoRaWAN
    communication, from raw radio frames to application-layer data.
  </p>

  <div class="component-row reveal reveal-delay-3">
    <div class="component-header">
      <h3>Uplink Pipeline</h3>
      <p>Processes incoming radio frames from gateways through deduplication, decryption, and MAC layer handling to produce decoded application events.</p>
    </div>
    <div class="component-details">
      <div class="component-detail-item">
        <span class="idx">01</span>
        <div>
          <h4>Gateway Deduplication</h4>
          <p>Multiple gateways may receive the same frame. ChirpStack deduplicates across all gateways and selects the best reception for metadata.</p>
        </div>
      </div>
      <div class="component-detail-item">
        <span class="idx">02</span>
        <div>
          <h4>Session Lookup &amp; Decryption</h4>
          <p>Looks up the device session by DevAddr, validates MIC, decrypts the FRMPayload using the appropriate session keys (NwkSKey / AppSKey).</p>
        </div>
      </div>
      <div class="component-detail-item">
        <span class="idx">03</span>
        <div>
          <h4>MAC Command Processing</h4>
          <p>24 MAC command handlers process network management commands: ADR, link checks, channel configuration, device status, and relay operations.</p>
        </div>
      </div>
      <div class="component-detail-item">
        <span class="idx">04</span>
        <div>
          <h4>Payload Decoding &amp; Event Dispatch</h4>
          <p>JavaScript codecs or Cayenne LPP decode raw bytes into structured data. Events are dispatched to all configured integrations.</p>
        </div>
      </div>
    </div>
  </div>

  <div class="component-row reveal">
    <div class="component-header">
      <h3>Downlink Pipeline</h3>
      <p>Manages the transmission of data and commands back to devices, handling class-specific scheduling and gateway selection.</p>
    </div>
    <div class="component-details">
      <div class="component-detail-item">
        <span class="idx">01</span>
        <div>
          <h4>Queue Management</h4>
          <p>Prioritized downlink queue per device. Application payloads, MAC commands, and multicast frames are queued with expiration tracking.</p>
        </div>
      </div>
      <div class="component-detail-item">
        <span class="idx">02</span>
        <div>
          <h4>Class-Specific Scheduling</h4>
          <p>Class A: RX1/RX2 receive windows after uplink. Class B: scheduled ping slots. Class C: immediate transmission via continuous receive window.</p>
        </div>
      </div>
      <div class="component-detail-item">
        <span class="idx">03</span>
        <div>
          <h4>Gateway Selection &amp; Transmission</h4>
          <p>Selects optimal gateway based on signal quality and duty-cycle constraints. Frames are encrypted, serialized, and dispatched to the gateway backend.</p>
        </div>
      </div>
    </div>
  </div>

  <div class="component-row reveal">
    <div class="component-header">
      <h3>gRPC API</h3>
      <p>Ten service definitions with full CRUD operations, streaming events, and management capabilities accessible from 10 programming languages.</p>
    </div>
    <div class="component-details">
      <div class="component-detail-item">
        <span class="idx">svc</span>
        <div>
          <h4>ApplicationService &middot; DeviceService &middot; DeviceProfileService</h4>
          <p>Manage applications, provision and activate devices, define device behaviors and codec configurations.</p>
        </div>
      </div>
      <div class="component-detail-item">
        <span class="idx">svc</span>
        <div>
          <h4>GatewayService &middot; TenantService &middot; UserService</h4>
          <p>Register gateways, manage multi-tenant isolation with role-based access, and handle user authentication with OpenID Connect / OAuth2.</p>
        </div>
      </div>
      <div class="component-detail-item">
        <span class="idx">svc</span>
        <div>
          <h4>FuotaService &middot; MulticastService &middot; RelayService</h4>
          <p>Firmware updates over-the-air, multicast group management for bulk operations, and LoRaWAN relay device configuration.</p>
        </div>
      </div>
      <div class="component-detail-item">
        <span class="idx">svc</span>
        <div>
          <h4>InternalService</h4>
          <p>Authentication, global search, system settings, API key management, and real-time event streaming via gRPC server streaming.</p>
        </div>
      </div>
    </div>
  </div>
</section>

<div class="diagonal-divider"></div>

<!-- ========== INTEGRATIONS ========== -->
<section class="integrations-section" id="integrations">
  <div class="section-label reveal">// 04</div>
  <h2 class="section-title reveal reveal-delay-1">18+ Integrations</h2>
  <p class="section-desc reveal reveal-delay-2">
    Every integration receives the same event types: uplink, join, ack, txack, status, location,
    log, and custom integration events. Global integrations apply to all applications; per-app
    integrations are configured individually.
  </p>

  <div class="integration-legend reveal reveal-delay-3">
    <div class="legend-item"><span class="chip-dot global"></span> Global Integration</div>
    <div class="legend-item"><span class="chip-dot per-app"></span> Per-Application</div>
  </div>

  <div class="integration-grid reveal reveal-delay-3">
    <div class="integration-chip"><span class="chip-dot global"></span> MQTT</div>
    <div class="integration-chip"><span class="chip-dot global"></span> PostgreSQL</div>
    <div class="integration-chip"><span class="chip-dot global"></span> AMQP / RabbitMQ</div>
    <div class="integration-chip"><span class="chip-dot global"></span> Apache Kafka</div>
    <div class="integration-chip"><span class="chip-dot global"></span> Redis</div>
    <div class="integration-chip"><span class="chip-dot per-app"></span> HTTP Webhooks</div>
    <div class="integration-chip"><span class="chip-dot per-app"></span> AWS SNS</div>
    <div class="integration-chip"><span class="chip-dot per-app"></span> Azure Service Bus</div>
    <div class="integration-chip"><span class="chip-dot per-app"></span> GCP Pub/Sub</div>
    <div class="integration-chip"><span class="chip-dot per-app"></span> InfluxDB v1 &amp; v2</div>
    <div class="integration-chip"><span class="chip-dot per-app"></span> ThingsBoard</div>
    <div class="integration-chip"><span class="chip-dot per-app"></span> Blynk</div>
    <div class="integration-chip"><span class="chip-dot per-app"></span> IFTTT</div>
    <div class="integration-chip"><span class="chip-dot per-app"></span> myDevices / Cayenne</div>
    <div class="integration-chip"><span class="chip-dot per-app"></span> Pilot Things</div>
  </div>
</section>

<div class="diagonal-divider-reverse"></div>

<!-- ========== SCENARIOS ========== -->
<section class="scenarios-section" id="scenarios">
  <div class="section-label reveal">// 05</div>
  <h2 class="section-title reveal reveal-delay-1">Best-Fit Scenarios</h2>
  <p class="section-desc reveal reveal-delay-2">
    ChirpStack adapts to deployments ranging from a single Raspberry Pi in a field
    to multi-tenant cloud platforms serving thousands of gateways.
  </p>

  <div class="scenario-grid">
    <div class="scenario-card reveal">
      <span class="scenario-number">01</span>
      <span class="scenario-tag">Municipal</span>
      <h3>Smart City Infrastructure</h3>
      <p>Hundreds of sensors across parking, waste, air quality, and lighting networks managed through multi-tenant isolation per department.</p>
      <div class="scenario-why"><strong>Why it fits:</strong> Multi-tenancy, gateway map visualization, ADR for fleet battery optimization, MQTT/Kafka for existing data platforms. Self-hosted means no per-device cloud fees at scale.</div>
    </div>

    <div class="scenario-card reveal reveal-delay-1">
      <span class="scenario-number">02</span>
      <span class="scenario-tag">Industrial</span>
      <h3>Industrial IoT &amp; Agriculture</h3>
      <p>Soil moisture, temperature, vibration, and tank level sensors deployed across large areas with limited connectivity.</p>
      <div class="scenario-why"><strong>Why it fits:</strong> Class A for battery sensors, Class C for actuators, FUOTA for remote firmware updates, SQLite backend for edge deployment on a single gateway device.</div>
    </div>

    <div class="scenario-card reveal reveal-delay-2">
      <span class="scenario-number">03</span>
      <span class="scenario-tag">Platform</span>
      <h3>LoRaWAN Platform-as-a-Service</h3>
      <p>Connectivity providers offering network services to multiple customers with white-labeled portals and per-customer cloud routing.</p>
      <div class="scenario-why"><strong>Why it fits:</strong> Multi-tenancy with roles, per-app integrations for customer-specific cloud targets, gRPC API in 10 languages for custom portals, OpenID Connect for enterprise SSO.</div>
    </div>

    <div class="scenario-card reveal reveal-delay-3">
      <span class="scenario-number">04</span>
      <span class="scenario-tag">Education</span>
      <h3>R&amp;D &amp; Prototyping</h3>
      <p>University labs, research teams, and hobbyists experimenting with LoRaWAN protocols and building proof-of-concept deployments.</p>
      <div class="scenario-why"><strong>Why it fits:</strong> Free and open-source, Docker Compose for one-command setup, SQLite for zero-dependency prototyping, raw frame inspection for learning the protocol.</div>
    </div>

    <div class="scenario-card reveal reveal-delay-4">
      <span class="scenario-number">05</span>
      <span class="scenario-tag">Custom</span>
      <h3>Custom IoT Applications</h3>
      <p>Developers building end-to-end solutions like asset tracking or environmental monitoring who need a network server as infrastructure.</p>
      <div class="scenario-why"><strong>Why it fits:</strong> gRPC streaming for real-time events, chirpstack-integration crate for custom Rust integrations, lrwn crate as standalone LoRaWAN library, JavaScript codec system.</div>
    </div>

    <div class="scenario-card reveal reveal-delay-5">
      <span class="scenario-number">06</span>
      <span class="scenario-tag">Secure</span>
      <h3>Air-Gapped &amp; Private Networks</h3>
      <p>Military, mining, or security-sensitive deployments where data cannot leave the premises. No external dependencies required.</p>
      <div class="scenario-why"><strong>Why it fits:</strong> Fully self-hosted, SQLite eliminates database server, ARM support for embedded hardware, MIT license with no phone-home. Runs entirely offline.</div>
    </div>

    <div class="scenario-card reveal reveal-delay-6" style="grid-column: span 2;">
      <span class="scenario-number">07</span>
      <span class="scenario-tag">Federation</span>
      <h3>LoRaWAN Roaming &amp; Network Federation</h3>
      <p>Multiple network operators enabling devices to seamlessly roam between networks via the LoRaWAN Backend Interfaces specification.
        ChirpStack handles passive roaming protocol negotiation, uplink forwarding, and downlink coordination between home and visited networks automatically.</p>
      <div class="scenario-why"><strong>Why it fits:</strong> LoRaWAN Backend Interfaces implementation, passive roaming (PRStartReq, PRStopReq, XmitDataReq), Join Server integration, NetID-based routing.</div>
    </div>
  </div>
</section>

<div class="diagonal-divider"></div>

<!-- ========== DEPLOYMENT ========== -->
<section class="deploy-section" id="deploy">
  <div class="section-label reveal">// 06</div>
  <h2 class="section-title reveal reveal-delay-1">Deployment Options</h2>
  <p class="section-desc reveal reveal-delay-2">
    From containerized cloud deployments to bare-metal edge installations,
    ChirpStack adapts to your infrastructure.
  </p>

  <div class="deploy-grid reveal reveal-delay-3">
    <div class="deploy-card">
      <span class="deploy-icon">&boxbox;</span>
      <h3>Docker Compose</h3>
      <p>One-command development and small production setups with all dependencies containerized.</p>
      <div class="deploy-db">PostgreSQL</div>
    </div>
    <div class="deploy-card">
      <span class="deploy-icon">&Copf;</span>
      <h3>Kubernetes</h3>
      <p>Horizontally scalable production deployments with orchestrated service management.</p>
      <div class="deploy-db">PostgreSQL</div>
    </div>
    <div class="deploy-card">
      <span class="deploy-icon">&LeftAngleBracket;/&RightAngleBracket;</span>
      <h3>Bare Metal / VM</h3>
      <p>Traditional server installations via .deb or .rpm packages with systemd units.</p>
      <div class="deploy-db">PostgreSQL or SQLite</div>
    </div>
    <div class="deploy-card">
      <span class="deploy-icon">&lozf;</span>
      <h3>Edge / Embedded</h3>
      <p>Single-gateway offline deployments on Raspberry Pi or industrial PCs.</p>
      <div class="deploy-db">SQLite</div>
    </div>
  </div>

  <div class="deploy-platforms reveal reveal-delay-4">
    <span class="deploy-platforms-label">Supported Platforms</span>
    <div class="platform-tags">
      <span class="platform-tag">linux/amd64</span>
      <span class="platform-tag">linux/arm64</span>
      <span class="platform-tag">linux/arm/v7</span>
      <span class="platform-tag">.deb (Debian/Ubuntu)</span>
      <span class="platform-tag">.rpm (RHEL/CentOS)</span>
      <span class="platform-tag">.tar.gz (Generic)</span>
      <span class="platform-tag">Docker Hub</span>
    </div>
  </div>
</section>

<!-- ========== API LANGUAGES ========== -->
<section class="api-section">
  <div class="section-label reveal">// 07</div>
  <h2 class="section-title reveal reveal-delay-1">API in 10 Languages</h2>
  <p class="section-desc reveal reveal-delay-2">
    Generated from Protocol Buffer definitions, ChirpStack's gRPC API provides
    type-safe client libraries for building custom applications and integrations.
  </p>

  <div class="lang-grid reveal reveal-delay-3">
    <span class="lang-tag">Rust</span>
    <span class="lang-tag">Go</span>
    <span class="lang-tag">Python</span>
    <span class="lang-tag">JavaScript</span>
    <span class="lang-tag">TypeScript</span>
    <span class="lang-tag">Java</span>
    <span class="lang-tag">Kotlin</span>
    <span class="lang-tag">C#</span>
    <span class="lang-tag">PHP</span>
    <span class="lang-tag">C</span>
  </div>
</section>

<div class="diagonal-divider"></div>

<!-- ========== PACKET SIMULATOR ========== -->
<section class="simulator-section" id="packet-simulator">
  <div class="section-label reveal">// 08</div>
  <h2 class="section-title reveal reveal-delay-1">LoRaWAN Packet Simulator</h2>
  <p class="section-desc reveal reveal-delay-2">
    Explore the byte-level structure of LoRaWAN frames. Select a frame type, click on
    individual bytes to inspect their bit-level fields, and see how the PHYPayload is constructed.
  </p>

  <div class="frame-type-selector reveal reveal-delay-3" id="frame-type-selector">
    <button class="frame-type-btn active" data-frame="data-uplink">Data Uplink</button>
    <button class="frame-type-btn" data-frame="data-downlink">Data Downlink</button>
    <button class="frame-type-btn" data-frame="join-request">Join Request</button>
    <button class="frame-type-btn" data-frame="join-accept">Join Accept</button>
  </div>

  <div class="simulator-grid reveal reveal-delay-3">
    <div class="byte-grid-panel">
      <h4>Byte Grid</h4>
      <div class="byte-grid" id="byte-grid"></div>
    </div>
    <div class="bit-breakdown-panel">
      <h4>Bit Breakdown</h4>
      <div id="bit-breakdown">
        <div class="bit-breakdown-empty">Click a byte to inspect its fields</div>
      </div>
    </div>
  </div>

  <div class="raw-hex-output reveal reveal-delay-4">
    <span class="hex-label">PHYPayload</span>
    <span class="hex-value" id="hex-output"></span>
    <button class="copy-btn" onclick="packetSimulator.copyHex()">Copy</button>
  </div>

  <div class="packet-legend reveal reveal-delay-4" id="packet-legend"></div>
</section>

<div class="diagonal-divider-reverse"></div>

<!-- ========== CONFIG BUILDER ========== -->
<section class="config-section" id="config-builder">
  <div class="section-label reveal">// 09</div>
  <h2 class="section-title reveal reveal-delay-1">Configuration Builder</h2>
  <p class="section-desc reveal reveal-delay-2">
    Interactively build a ChirpStack configuration file. Adjust settings in the form
    and watch the TOML preview update in real time. Copy or download when ready.
  </p>

  <div class="config-container reveal reveal-delay-3">
    <div class="config-form-panel" id="config-form">

      <!-- Database -->
      <div class="config-section-block">
        <div class="config-section-header" onclick="configBuilder.toggleSection(this)">
          Database
          <span class="toggle-icon">&#9660;</span>
        </div>
        <div class="config-section-body">
          <div class="radio-group">
            <label><input type="radio" name="db_type" value="postgresql" checked onchange="configBuilder.update()"> PostgreSQL</label>
            <label><input type="radio" name="db_type" value="sqlite" onchange="configBuilder.update()"> SQLite</label>
          </div>
          <div class="conditional-field visible" id="pg-fields">
            <div class="form-group">
              <label>DSN</label>
              <input class="form-input" id="pg-dsn" value="postgres://chirpstack:chirpstack@localhost/chirpstack?sslmode=disable" oninput="configBuilder.update()">
            </div>
            <div class="form-group">
              <label>Max Open Connections</label>
              <input class="form-input" id="pg-max-conn" type="number" value="10" oninput="configBuilder.update()">
            </div>
          </div>
          <div class="conditional-field" id="sqlite-fields">
            <div class="form-group">
              <label>Path</label>
              <input class="form-input" id="sqlite-path" value="/etc/chirpstack/chirpstack.db" oninput="configBuilder.update()">
            </div>
          </div>
        </div>
      </div>

      <!-- Redis -->
      <div class="config-section-block">
        <div class="config-section-header" onclick="configBuilder.toggleSection(this)">
          Redis
          <span class="toggle-icon">&#9660;</span>
        </div>
        <div class="config-section-body">
          <div class="form-group">
            <label>Servers</label>
            <input class="form-input" id="redis-servers" value="redis://127.0.0.1/" oninput="configBuilder.update()">
          </div>
          <div class="form-group">
            <label style="display:flex;align-items:center;gap:8px;cursor:pointer">
              <input type="checkbox" id="redis-cluster" onchange="configBuilder.update()" style="accent-color:var(--teal)">
              Cluster Mode
            </label>
          </div>
        </div>
      </div>

      <!-- Network -->
      <div class="config-section-block">
        <div class="config-section-header" onclick="configBuilder.toggleSection(this)">
          Network
          <span class="toggle-icon">&#9660;</span>
        </div>
        <div class="config-section-body">
          <div class="form-group">
            <label>Net ID (hex)</label>
            <input class="form-input" id="net-id" value="000000" maxlength="6" oninput="configBuilder.update()">
          </div>
          <div class="form-group">
            <label>Enabled Regions</label>
            <div class="checkbox-grid" id="region-checkboxes">
              <label><input type="checkbox" checked value="eu868" onchange="configBuilder.update()"> EU868</label>
              <label><input type="checkbox" value="us915_0" onchange="configBuilder.update()"> US915</label>
              <label><input type="checkbox" value="as923" onchange="configBuilder.update()"> AS923</label>
              <label><input type="checkbox" value="as923_2" onchange="configBuilder.update()"> AS923-2</label>
              <label><input type="checkbox" value="as923_3" onchange="configBuilder.update()"> AS923-3</label>
              <label><input type="checkbox" value="as923_4" onchange="configBuilder.update()"> AS923-4</label>
              <label><input type="checkbox" value="au915_0" onchange="configBuilder.update()"> AU915</label>
              <label><input type="checkbox" value="cn470_0" onchange="configBuilder.update()"> CN470</label>
              <label><input type="checkbox" value="cn779" onchange="configBuilder.update()"> CN779</label>
              <label><input type="checkbox" value="eu433" onchange="configBuilder.update()"> EU433</label>
              <label><input type="checkbox" value="in865" onchange="configBuilder.update()"> IN865</label>
              <label><input type="checkbox" value="ism2400" onchange="configBuilder.update()"> ISM2400</label>
              <label><input type="checkbox" value="kr920" onchange="configBuilder.update()"> KR920</label>
              <label><input type="checkbox" value="ru864" onchange="configBuilder.update()"> RU864</label>
            </div>
          </div>
        </div>
      </div>

      <!-- API -->
      <div class="config-section-block">
        <div class="config-section-header" onclick="configBuilder.toggleSection(this)">
          API
          <span class="toggle-icon">&#9660;</span>
        </div>
        <div class="config-section-body">
          <div class="form-group">
            <label>Bind Address</label>
            <input class="form-input" id="api-bind" value="0.0.0.0:8080" oninput="configBuilder.update()">
          </div>
          <div class="form-group">
            <label>Secret (JWT signing)
              <button class="generate-btn" type="button" onclick="configBuilder.generateSecret()">Generate Random</button>
            </label>
            <input class="form-input" id="api-secret" value="" placeholder="Click Generate Random" oninput="configBuilder.update()">
          </div>
        </div>
      </div>

      <!-- Integrations -->
      <div class="config-section-block">
        <div class="config-section-header" onclick="configBuilder.toggleSection(this)">
          Integrations
          <span class="toggle-icon">&#9660;</span>
        </div>
        <div class="config-section-body">
          <div class="form-group">
            <label>Enabled Integrations</label>
            <div class="checkbox-grid">
              <label><input type="checkbox" checked value="mqtt" class="integration-toggle" onchange="configBuilder.toggleIntegration('mqtt', this.checked)"> MQTT</label>
              <label><input type="checkbox" value="postgresql" class="integration-toggle" onchange="configBuilder.toggleIntegration('postgresql', this.checked)"> PostgreSQL</label>
              <label><input type="checkbox" value="amqp" class="integration-toggle" onchange="configBuilder.toggleIntegration('amqp', this.checked)"> AMQP</label>
              <label><input type="checkbox" value="kafka" class="integration-toggle" onchange="configBuilder.toggleIntegration('kafka', this.checked)"> Kafka</label>
            </div>
          </div>
          <div class="integration-config visible" id="int-mqtt">
            <div class="form-group">
              <label>MQTT Server</label>
              <input class="form-input" value="tcp://127.0.0.1:1883" oninput="configBuilder.update()" data-int="mqtt-server">
            </div>
            <div class="form-group">
              <label>Username</label>
              <input class="form-input" value="" placeholder="(optional)" oninput="configBuilder.update()" data-int="mqtt-username">
            </div>
            <div class="form-group">
              <label>Password</label>
              <input class="form-input" type="password" value="" placeholder="(optional)" oninput="configBuilder.update()" data-int="mqtt-password">
            </div>
          </div>
          <div class="integration-config" id="int-postgresql">
            <div class="form-group">
              <label>PostgreSQL DSN</label>
              <input class="form-input" value="postgres://chirpstack_integration:chirpstack@localhost/chirpstack_integration?sslmode=disable" oninput="configBuilder.update()" data-int="pg-int-dsn">
            </div>
          </div>
          <div class="integration-config" id="int-amqp">
            <div class="form-group">
              <label>AMQP URL</label>
              <input class="form-input" value="amqp://guest:guest@localhost:5672" oninput="configBuilder.update()" data-int="amqp-url">
            </div>
          </div>
          <div class="integration-config" id="int-kafka">
            <div class="form-group">
              <label>Kafka Brokers</label>
              <input class="form-input" value="localhost:9092" oninput="configBuilder.update()" data-int="kafka-brokers">
            </div>
            <div class="form-group">
              <label>Topic</label>
              <input class="form-input" value="chirpstack" oninput="configBuilder.update()" data-int="kafka-topic">
            </div>
          </div>
        </div>
      </div>

      <!-- Authentication -->
      <div class="config-section-block">
        <div class="config-section-header" onclick="configBuilder.toggleSection(this)">
          Authentication
          <span class="toggle-icon">&#9660;</span>
        </div>
        <div class="config-section-body">
          <div class="radio-group" style="flex-direction:column;gap:8px">
            <label><input type="radio" name="auth_type" value="internal" checked onchange="configBuilder.update()"> Internal (built-in)</label>
            <label><input type="radio" name="auth_type" value="openid_connect" onchange="configBuilder.update()"> OpenID Connect</label>
            <label><input type="radio" name="auth_type" value="oauth2" onchange="configBuilder.update()"> OAuth2</label>
          </div>
        </div>
      </div>

    </div>

    <div class="config-preview-panel">
      <div class="config-preview-header">
        <span>chirpstack.toml</span>
        <div class="config-preview-actions">
          <button onclick="configBuilder.copyTOML()">Copy</button>
          <button onclick="configBuilder.downloadTOML()">Download</button>
        </div>
      </div>
      <div class="toml-preview" id="toml-preview"></div>
    </div>
  </div>
</section>

<div class="diagonal-divider"></div>

<!-- ========== FOOTER ========== -->
<footer>
  <div class="footer-left">
    ChirpStack is open-source under the MIT License &middot;
    <a href="https://github.com/chirpstack/chirpstack" target="_blank" rel="noopener">github.com/chirpstack/chirpstack</a>
  </div>
  <div class="footer-right">
    v4.16.1 &middot; Informational Reference
  </div>
</footer>

<script>
// ========== SCROLL REVEAL ==========
const revealObserver = new IntersectionObserver((entries) => {
  entries.forEach(entry => {
    if (entry.isIntersecting) {
      entry.target.classList.add('visible');
    }
  });
}, { threshold: 0.1, rootMargin: '0px 0px -40px 0px' });

document.querySelectorAll('.reveal').forEach(el => revealObserver.observe(el));

// ========== COUNTER ANIMATION ==========
let countersAnimated = false;
const counterObserver = new IntersectionObserver((entries) => {
  entries.forEach(entry => {
    if (entry.isIntersecting && !countersAnimated) {
      countersAnimated = true;
      document.querySelectorAll('[data-count]').forEach(el => {
        const target = parseInt(el.dataset.count);
        const duration = 1600;
        const startTime = performance.now();

        function updateCounter(currentTime) {
          const elapsed = currentTime - startTime;
          const progress = Math.min(elapsed / duration, 1);
          // Ease out cubic
          const eased = 1 - Math.pow(1 - progress, 3);
          const current = Math.round(eased * target);

          // Add + suffix for specific counts
          if (target === 18) {
            el.textContent = current + '+';
          } else {
            el.textContent = current;
          }

          if (progress < 1) {
            requestAnimationFrame(updateCounter);
          }
        }

        requestAnimationFrame(updateCounter);
      });
    }
  });
}, { threshold: 0.5 });

const statsBar = document.querySelector('.stats-bar');
if (statsBar) counterObserver.observe(statsBar);

// ========== SMOOTH NAV SCROLL ==========
document.querySelectorAll('.nav-links a').forEach(link => {
  link.addEventListener('click', (e) => {
    e.preventDefault();
    const targetId = link.getAttribute('href');
    const target = document.querySelector(targetId);
    if (target) {
      target.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
  });
});

// ========== NAV BACKGROUND TRANSITION ==========
const nav = document.querySelector('nav');
let lastScroll = 0;

window.addEventListener('scroll', () => {
  const scrollY = window.scrollY;
  if (scrollY > 100) {
    nav.style.borderBottomColor = 'var(--border-light)';
  } else {
    nav.style.borderBottomColor = 'var(--border)';
  }
  lastScroll = scrollY;
}, { passive: true });

// ========== FLOW SIMULATOR ==========
const flowSimulator = {
  running: false,
  stages: [
    { nodeId: 'flow-stage-1', label: 'Sensor TX', msg: 'Sensor transmits uplink frame: SF7 BW125 at 868.1MHz, 14dBm TX power, DevAddr 01ABCDEF', meta: null },
    { nodeId: 'flow-stage-2', label: 'Gateway RX', msg: 'Gateway receives frame: RSSI -72dBm, SNR 8.5dB. 3 gateways reported reception.', meta: null },
    { nodeId: 'flow-stage-3', label: 'Dedup', msg: 'Deduplication: 3 copies merged. Best RSSI from GW-0a2b (-72dBm) selected as primary.', meta: 'Dedup: 3 frames &rarr; 1<br>Best RSSI: GW-0a2b (-72dBm)' },
    { nodeId: 'flow-stage-3', label: 'Decrypt', msg: 'MIC validated (correct). FRMPayload decrypted with AppSKey. Payload: 0x48656C6C6F ("Hello").', meta: 'MIC: valid &check;<br>Payload: 48656C6C6F ("Hello")' },
    { nodeId: 'flow-stage-3', label: 'MAC Proc', msg: 'ADR engine: current DR0, optimal DR3. Scheduling LinkADRReq in next downlink. Battery: 78%.', meta: 'ADR: DR0 &rarr; DR3 adjustment<br>LinkADRReq scheduled' },
    { nodeId: 'flow-stage-6', label: 'Dispatch', msg: 'Event published to MQTT topic application/1/device/01abcdef/event/up. HTTP webhook queued.', meta: null }
  ],

  addLog(stage, msg) {
    const container = document.getElementById('flow-log-entries');
    const now = new Date();
    const ts = [now.getHours(), now.getMinutes(), now.getSeconds()]
      .map(n => String(n).padStart(2, '0')).join(':') + '.' +
      String(now.getMilliseconds()).padStart(3, '0');
    const entry = document.createElement('div');
    entry.className = 'log-entry';
    entry.innerHTML = '<span class="log-time">' + ts + '</span><span class="log-stage">[' + stage + ']</span><span class="log-msg">' + msg + '</span>';
    container.appendChild(entry);
    // Cap at 50
    while (container.children.length > 50) container.removeChild(container.firstChild);
    const panel = document.getElementById('flow-log-panel');
    panel.scrollTop = panel.scrollHeight;
  },

  sleep(ms) { return new Promise(r => setTimeout(r, ms)); },

  async start() {
    if (this.running) return;
    this.running = true;
    document.getElementById('btn-simulate').disabled = true;
    this.addLog('SIM', 'Simulation started');

    const metaEl = document.getElementById('core-stage-meta');

    for (const stage of this.stages) {
      const el = document.getElementById(stage.nodeId);
      if (el) {
        el.classList.remove('stage-complete');
        el.classList.add('stage-active');
      }
      if (stage.meta && metaEl) {
        metaEl.innerHTML = stage.meta;
      }
      this.addLog(stage.label, stage.msg);
      await this.sleep(800);
      // Only mark complete if next stage uses a different node
      const idx = this.stages.indexOf(stage);
      const nextStage = this.stages[idx + 1];
      if (!nextStage || nextStage.nodeId !== stage.nodeId) {
        if (el) {
          el.classList.remove('stage-active');
          el.classList.add('stage-complete');
        }
      }
    }

    this.addLog('SIM', 'Simulation complete. All 6 stages processed successfully.');
    this.running = false;
    document.getElementById('btn-simulate').disabled = false;
  },

  reset() {
    this.running = false;
    document.getElementById('btn-simulate').disabled = false;
    ['flow-stage-1', 'flow-stage-2', 'flow-stage-3', 'flow-stage-6'].forEach(id => {
      const el = document.getElementById(id);
      if (el) el.classList.remove('stage-active', 'stage-complete');
    });
    const metaEl = document.getElementById('core-stage-meta');
    if (metaEl) metaEl.innerHTML = 'Dedup: 3 frames &rarr; 1<br>Best RSSI: GW-0a2b (-72dBm)';
    document.getElementById('flow-log-entries').innerHTML = '';
    this.addLog('SIM', 'Simulation reset.');
  }
};

// ========== PACKET SIMULATOR ==========
const packetSimulator = {
  frameType: 'data-uplink',
  selectedByteIndex: -1,

  frames: {
    'data-uplink': {
      label: 'Unconfirmed Data Up',
      bytes: [0x40, 0xEF, 0xCD, 0xAB, 0x01, 0x00, 0x01, 0x00, 0x01, 0x48, 0x65, 0x6C, 0x6C, 0x6F, 0xAA, 0xBB, 0xCC, 0xDD],
      fields: [
        { name: 'MHDR', cls: 'mhdr', start: 0, len: 1 },
        { name: 'DevAddr', cls: 'devaddr', start: 1, len: 4 },
        { name: 'FCtrl', cls: 'fctrl', start: 5, len: 1 },
        { name: 'FCnt', cls: 'fcnt', start: 6, len: 2 },
        { name: 'FPort', cls: 'fport', start: 8, len: 1 },
        { name: 'FRMPayload', cls: 'payload', start: 9, len: 5 },
        { name: 'MIC', cls: 'mic', start: 14, len: 4 }
      ],
      legend: [
        { cls: 'mhdr', label: 'MHDR' }, { cls: 'devaddr', label: 'DevAddr' },
        { cls: 'fctrl', label: 'FCtrl' }, { cls: 'fcnt', label: 'FCnt' },
        { cls: 'fport', label: 'FPort' }, { cls: 'payload', label: 'FRMPayload' },
        { cls: 'mic', label: 'MIC' }
      ]
    },
    'data-downlink': {
      label: 'Unconfirmed Data Down',
      bytes: [0x60, 0xEF, 0xCD, 0xAB, 0x01, 0x20, 0x01, 0x00, 0x01, 0x02, 0x03, 0x04, 0x11, 0x22, 0x33, 0x44],
      fields: [
        { name: 'MHDR', cls: 'mhdr', start: 0, len: 1 },
        { name: 'DevAddr', cls: 'devaddr', start: 1, len: 4 },
        { name: 'FCtrl', cls: 'fctrl', start: 5, len: 1 },
        { name: 'FCnt', cls: 'fcnt', start: 6, len: 2 },
        { name: 'FPort', cls: 'fport', start: 8, len: 1 },
        { name: 'FRMPayload', cls: 'payload', start: 9, len: 3 },
        { name: 'MIC', cls: 'mic', start: 12, len: 4 }
      ],
      legend: [
        { cls: 'mhdr', label: 'MHDR' }, { cls: 'devaddr', label: 'DevAddr' },
        { cls: 'fctrl', label: 'FCtrl' }, { cls: 'fcnt', label: 'FCnt' },
        { cls: 'fport', label: 'FPort' }, { cls: 'payload', label: 'FRMPayload' },
        { cls: 'mic', label: 'MIC' }
      ]
    },
    'join-request': {
      label: 'Join Request',
      bytes: [0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x0A, 0x0B, 0x0C, 0x0D, 0x0E, 0x0F, 0x10, 0x11, 0x34, 0x12, 0xAA, 0xBB, 0xCC, 0xDD],
      fields: [
        { name: 'MHDR', cls: 'mhdr', start: 0, len: 1 },
        { name: 'JoinEUI', cls: 'joineui', start: 1, len: 8 },
        { name: 'DevEUI', cls: 'deveui', start: 9, len: 8 },
        { name: 'DevNonce', cls: 'devnonce', start: 17, len: 2 },
        { name: 'MIC', cls: 'mic', start: 19, len: 4 }
      ],
      legend: [
        { cls: 'mhdr', label: 'MHDR' }, { cls: 'joineui', label: 'JoinEUI' },
        { cls: 'deveui', label: 'DevEUI' }, { cls: 'devnonce', label: 'DevNonce' },
        { cls: 'mic', label: 'MIC' }
      ]
    },
    'join-accept': {
      label: 'Join Accept',
      bytes: [0x20, 0xAA, 0xBB, 0xCC, 0x01, 0x02, 0x03, 0xEF, 0xCD, 0xAB, 0x01, 0x03, 0x01, 0x11, 0x22, 0x33, 0x44],
      fields: [
        { name: 'MHDR', cls: 'mhdr', start: 0, len: 1 },
        { name: 'JoinNonce', cls: 'joinnonce', start: 1, len: 3 },
        { name: 'HomeNetID', cls: 'homenetid', start: 4, len: 3 },
        { name: 'DevAddr', cls: 'devaddr', start: 7, len: 4 },
        { name: 'DLSettings', cls: 'dlsettings', start: 11, len: 1 },
        { name: 'RxDelay', cls: 'rxdelay', start: 12, len: 1 },
        { name: 'MIC', cls: 'mic', start: 13, len: 4 }
      ],
      legend: [
        { cls: 'mhdr', label: 'MHDR' }, { cls: 'joinnonce', label: 'JoinNonce' },
        { cls: 'homenetid', label: 'HomeNetID' }, { cls: 'devaddr', label: 'DevAddr' },
        { cls: 'dlsettings', label: 'DLSettings' }, { cls: 'rxdelay', label: 'RxDelay' },
        { cls: 'mic', label: 'MIC' }
      ]
    }
  },

  parseMHDR(byte) {
    const mtype = (byte >> 5) & 0x07;
    const mtypeNames = ['Join Request','Join Accept','Unconfirmed Data Up','Unconfirmed Data Down','Confirmed Data Up','Confirmed Data Down','Rejoin Request','Proprietary'];
    const rfu = (byte >> 2) & 0x07;
    const major = byte & 0x03;
    return [
      { name: 'MType', bits: '7:5', value: mtype, desc: mtypeNames[mtype] || 'Unknown' },
      { name: 'RFU', bits: '4:2', value: rfu, desc: 'Reserved for future use' },
      { name: 'Major', bits: '1:0', value: major, desc: major === 0 ? 'LoRaWAN R1' : 'Unknown' }
    ];
  },

  parseFCtrl(byte, isUplink) {
    const adr = (byte >> 7) & 1;
    const bit6 = (byte >> 6) & 1;
    const ack = (byte >> 5) & 1;
    const bit4 = (byte >> 4) & 1;
    const foptslen = byte & 0x0F;
    if (isUplink) {
      return [
        { name: 'ADR', bits: '7', value: adr, desc: adr ? 'ADR enabled' : 'ADR disabled' },
        { name: 'ADRACKReq', bits: '6', value: bit6, desc: bit6 ? 'ADR ack requested' : 'No ADR ack request' },
        { name: 'ACK', bits: '5', value: ack, desc: ack ? 'Acknowledging previous downlink' : 'No ack' },
        { name: 'ClassB', bits: '4', value: bit4, desc: bit4 ? 'Class B enabled' : 'Class A' },
        { name: 'FOptsLen', bits: '3:0', value: foptslen, desc: foptslen + ' bytes of FOpts' }
      ];
    } else {
      return [
        { name: 'ADR', bits: '7', value: adr, desc: adr ? 'ADR enabled' : 'ADR disabled' },
        { name: 'RFU', bits: '6', value: bit6, desc: 'Reserved' },
        { name: 'ACK', bits: '5', value: ack, desc: ack ? 'Acknowledging previous uplink' : 'No ack' },
        { name: 'FPending', bits: '4', value: bit4, desc: bit4 ? 'More data pending' : 'No pending data' },
        { name: 'FOptsLen', bits: '3:0', value: foptslen, desc: foptslen + ' bytes of FOpts' }
      ];
    }
  },

  parseDLSettings(byte) {
    const optNeg = (byte >> 7) & 1;
    const rx1droffset = (byte >> 4) & 0x07;
    const rx2dr = byte & 0x0F;
    return [
      { name: 'OptNeg', bits: '7', value: optNeg, desc: optNeg ? 'LoRaWAN 1.1+' : 'LoRaWAN 1.0.x' },
      { name: 'RX1DROffset', bits: '6:4', value: rx1droffset, desc: 'RX1 data rate offset: ' + rx1droffset },
      { name: 'RX2DataRate', bits: '3:0', value: rx2dr, desc: 'RX2 data rate: DR' + rx2dr }
    ];
  },

  getFieldForByteIndex(index) {
    const frame = this.frames[this.frameType];
    for (const f of frame.fields) {
      if (index >= f.start && index < f.start + f.len) return f;
    }
    return null;
  },

  renderByteGrid() {
    const frame = this.frames[this.frameType];
    const grid = document.getElementById('byte-grid');
    grid.innerHTML = '';
    frame.bytes.forEach((b, i) => {
      const field = this.getFieldForByteIndex(i);
      const el = document.createElement('div');
      el.className = 'byte-block' + (field ? ' ' + field.cls : '') + (i === this.selectedByteIndex ? ' selected' : '');
      el.textContent = b.toString(16).toUpperCase().padStart(2, '0');
      el.addEventListener('click', () => {
        this.selectedByteIndex = i;
        this.renderByteGrid();
        this.renderBitBreakdown(i);
      });
      grid.appendChild(el);
    });
    // Hex output
    document.getElementById('hex-output').textContent =
      frame.bytes.map(b => b.toString(16).toUpperCase().padStart(2, '0')).join('');
    // Legend
    const legend = document.getElementById('packet-legend');
    legend.innerHTML = frame.legend.map(l =>
      '<div class="legend-swatch"><div class="swatch ' + l.cls + '"></div>' + l.label + '</div>'
    ).join('');
  },

  renderBitBreakdown(index) {
    const container = document.getElementById('bit-breakdown');
    const frame = this.frames[this.frameType];
    const field = this.getFieldForByteIndex(index);
    if (!field) {
      container.innerHTML = '<div class="bit-breakdown-empty">No field data for this byte</div>';
      return;
    }
    const byte = frame.bytes[index];
    let bits = [];
    if (field.name === 'MHDR') {
      bits = this.parseMHDR(byte);
    } else if (field.name === 'FCtrl') {
      const isUp = this.frameType === 'data-uplink';
      bits = this.parseFCtrl(byte, isUp);
    } else if (field.name === 'DLSettings') {
      bits = this.parseDLSettings(byte);
    } else {
      // Generic: show the byte value and field info
      const posInField = index - field.start;
      const isLE = ['DevAddr','FCnt','JoinEUI','DevEUI','DevNonce','JoinNonce','HomeNetID'].includes(field.name);
      bits = [{
        name: field.name + ' [byte ' + posInField + ']',
        bits: '7:0',
        value: '0x' + byte.toString(16).toUpperCase().padStart(2, '0'),
        desc: field.len > 1 ? (isLE ? 'Little-endian byte ' + posInField + ' of ' + field.len : 'Byte ' + posInField + ' of ' + field.len) : 'Single byte field'
      }];
    }
    container.innerHTML = '<div style="font-family:var(--mono);font-size:13px;color:var(--amber);margin-bottom:12px">' +
      field.name + ' &mdash; 0x' + byte.toString(16).toUpperCase().padStart(2, '0') +
      ' (' + byte.toString(2).padStart(8, '0') + ')</div>' +
      bits.map(b =>
        '<div class="bit-field"><span class="bit-field-name">' + b.name + '</span>' +
        '<span class="bit-field-bits">bits[' + b.bits + ']</span>' +
        '<span class="bit-field-value">' + b.value + '</span></div>' +
        '<div class="bit-field-desc">' + b.desc + '</div>'
      ).join('');
  },

  selectFrameType(type) {
    this.frameType = type;
    this.selectedByteIndex = -1;
    document.querySelectorAll('.frame-type-btn').forEach(btn => {
      btn.classList.toggle('active', btn.dataset.frame === type);
    });
    this.renderByteGrid();
    document.getElementById('bit-breakdown').innerHTML =
      '<div class="bit-breakdown-empty">Click a byte to inspect its fields</div>';
  },

  copyHex() {
    const hex = document.getElementById('hex-output').textContent;
    navigator.clipboard.writeText(hex).then(() => {
      const btn = document.querySelector('.raw-hex-output .copy-btn');
      const orig = btn.textContent;
      btn.textContent = 'Copied!';
      setTimeout(() => btn.textContent = orig, 1500);
    });
  }
};

// Init frame type selector
document.querySelectorAll('.frame-type-btn').forEach(btn => {
  btn.addEventListener('click', () => packetSimulator.selectFrameType(btn.dataset.frame));
});
packetSimulator.renderByteGrid();

// ========== CONFIG BUILDER ==========
const configBuilder = {
  debounceTimer: null,

  toggleSection(header) {
    const body = header.nextElementSibling;
    const icon = header.querySelector('.toggle-icon');
    body.classList.toggle('open');
    icon.classList.toggle('open');
  },

  toggleIntegration(name, checked) {
    const el = document.getElementById('int-' + name);
    if (el) el.classList.toggle('visible', checked);
    this.update();
  },

  generateSecret() {
    const arr = new Uint8Array(32);
    crypto.getRandomValues(arr);
    const secret = Array.from(arr).map(b => b.toString(16).padStart(2, '0')).join('');
    document.getElementById('api-secret').value = secret;
    this.update();
  },

  syncFormToState() {
    const dbType = document.querySelector('input[name="db_type"]:checked').value;
    // Toggle conditional fields
    document.getElementById('pg-fields').classList.toggle('visible', dbType === 'postgresql');
    document.getElementById('sqlite-fields').classList.toggle('visible', dbType === 'sqlite');

    const state = {
      dbType,
      pgDsn: document.getElementById('pg-dsn').value,
      pgMaxConn: parseInt(document.getElementById('pg-max-conn').value) || 10,
      sqlitePath: document.getElementById('sqlite-path').value,
      redisServers: document.getElementById('redis-servers').value,
      redisCluster: document.getElementById('redis-cluster').checked,
      netId: document.getElementById('net-id').value,
      regions: [],
      apiBind: document.getElementById('api-bind').value,
      apiSecret: document.getElementById('api-secret').value,
      integrations: [],
      mqttServer: (document.querySelector('[data-int="mqtt-server"]') || {}).value || '',
      mqttUsername: (document.querySelector('[data-int="mqtt-username"]') || {}).value || '',
      mqttPassword: (document.querySelector('[data-int="mqtt-password"]') || {}).value || '',
      pgIntDsn: (document.querySelector('[data-int="pg-int-dsn"]') || {}).value || '',
      amqpUrl: (document.querySelector('[data-int="amqp-url"]') || {}).value || '',
      kafkaBrokers: (document.querySelector('[data-int="kafka-brokers"]') || {}).value || '',
      kafkaTopic: (document.querySelector('[data-int="kafka-topic"]') || {}).value || '',
      authType: document.querySelector('input[name="auth_type"]:checked').value
    };

    document.querySelectorAll('#region-checkboxes input:checked').forEach(cb => {
      state.regions.push(cb.value);
    });
    document.querySelectorAll('.integration-toggle:checked').forEach(cb => {
      state.integrations.push(cb.value);
    });

    return state;
  },

  generateTOML(state) {
    let t = '';
    t += '# ChirpStack Configuration\n';
    t += '# Generated by Configuration Builder\n\n';
    t += '[logging]\n';
    t += '  level = "info"\n\n';

    if (state.dbType === 'postgresql') {
      t += '[postgresql]\n';
      t += '  dsn = "' + state.pgDsn + '"\n';
      t += '  max_open_connections = ' + state.pgMaxConn + '\n\n';
    } else {
      t += '[sqlite]\n';
      t += '  path = "' + state.sqlitePath + '"\n\n';
    }

    t += '[redis]\n';
    t += '  servers = [\n';
    t += '    "' + state.redisServers + '",\n';
    t += '  ]\n';
    t += '  cluster = ' + state.redisCluster + '\n\n';

    t += '[network]\n';
    t += '  net_id = "' + state.netId + '"\n';
    t += '  enabled_regions = [\n';
    state.regions.forEach(r => {
      t += '    "' + r + '",\n';
    });
    t += '  ]\n\n';

    t += '[api]\n';
    t += '  bind = "' + state.apiBind + '"\n';
    if (state.apiSecret) {
      t += '  secret = "' + state.apiSecret + '"\n';
    }
    t += '\n';

    t += '[integration]\n';
    t += '  enabled = [\n';
    state.integrations.forEach(i => {
      t += '    "' + i + '",\n';
    });
    t += '  ]\n\n';

    if (state.integrations.includes('mqtt')) {
      t += '  [integration.mqtt]\n';
      t += '    server = "' + state.mqttServer + '"\n';
      if (state.mqttUsername) t += '    username = "' + state.mqttUsername + '"\n';
      if (state.mqttPassword) t += '    password = "' + state.mqttPassword + '"\n';
      t += '\n';
    }
    if (state.integrations.includes('postgresql')) {
      t += '  [integration.postgresql]\n';
      t += '    dsn = "' + state.pgIntDsn + '"\n\n';
    }
    if (state.integrations.includes('amqp')) {
      t += '  [integration.amqp]\n';
      t += '    url = "' + state.amqpUrl + '"\n\n';
    }
    if (state.integrations.includes('kafka')) {
      t += '  [integration.kafka]\n';
      t += '    brokers = [\n';
      t += '      "' + state.kafkaBrokers + '",\n';
      t += '    ]\n';
      t += '    topic = "' + state.kafkaTopic + '"\n\n';
    }

    t += '[user_authentication]\n';
    t += '  type = "' + state.authType + '"\n';

    return t;
  },

  highlightTOML(toml) {
    return toml
      .replace(/&/g, '&amp;')
      .replace(/</g, '&lt;')
      .replace(/>/g, '&gt;')
      // Comments
      .replace(/(#.*)/g, '<span class="toml-comment">$1</span>')
      // Section headers
      .replace(/^(\s*\[[\w.]+\])/gm, '<span class="toml-section">$1</span>')
      // Strings (after section headers to avoid double-matching)
      .replace(/"([^"]*?)"/g, '<span class="toml-string">"$1"</span>')
      // Booleans
      .replace(/= (true|false)/g, '= <span class="toml-boolean">$1</span>')
      // Numbers (standalone)
      .replace(/= (\d+)$/gm, '= <span class="toml-number">$1</span>')
      // Keys
      .replace(/^(\s*\w[\w_]*)\s*=/gm, '<span class="toml-key">$1</span> =');
  },

  update() {
    clearTimeout(this.debounceTimer);
    this.debounceTimer = setTimeout(() => {
      const state = this.syncFormToState();
      const toml = this.generateTOML(state);
      document.getElementById('toml-preview').innerHTML = this.highlightTOML(toml);
    }, 100);
  },

  copyTOML() {
    const state = this.syncFormToState();
    const toml = this.generateTOML(state);
    navigator.clipboard.writeText(toml).then(() => {
      const btns = document.querySelectorAll('.config-preview-actions button');
      const btn = btns[0];
      const orig = btn.textContent;
      btn.textContent = 'Copied!';
      setTimeout(() => btn.textContent = orig, 1500);
    });
  },

  downloadTOML() {
    const state = this.syncFormToState();
    const toml = this.generateTOML(state);
    const blob = new Blob([toml], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'chirpstack.toml';
    a.click();
    URL.revokeObjectURL(url);
  }
};

// Initialize config builder
configBuilder.update();
</script>

</body>
</html>
